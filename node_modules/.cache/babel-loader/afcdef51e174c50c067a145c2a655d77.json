{"ast":null,"code":"import { updateAvatarAPI } from '@/api';\nimport { mapGetters } from 'vuex'; // import { onMounted } from 'vue'\n\nexport default {\n  name: 'my-user',\n  computed: { ...mapGetters(['nickname', 'image', 'introduction', 'area', 'contact', 'sex', 'birthday'])\n  },\n\n  data() {\n    return {\n      // 保存照片的链接--base64字符串\n      avatar: '',\n      // 表单数据部分,目前无用\n      // ruleForm: {\n      //   nickname: '',\n      //   sex: '',\n      //   birthday: '',\n      //   introduction: '',\n      //   contact: '',\n      //   area: ''\n      // },\n      ruleForm: this.$store.state.userInfo,\n      rules: {\n        nickname: [{\n          required: true,\n          message: '姓名',\n          trigger: 'blur'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ],\n        sex: [{\n          required: true,\n          message: '性别',\n          trigger: 'blur'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ],\n        birthday: [{\n          required: true,\n          message: '生日',\n          trigger: 'blur',\n          type: 'string'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ],\n        introduction: [{\n          required: true,\n          message: '简介',\n          trigger: 'blur'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ],\n        contact: [{\n          required: true,\n          message: '联系方式',\n          trigger: 'blur'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ],\n        area: [{\n          required: true,\n          message: '地区',\n          trigger: 'blur'\n        } // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\n        ]\n      }\n    };\n  },\n\n  methods: {\n    // 点击选择头像\n    chooseImg() {\n      // 模拟点击事件\n      this.$refs.iptRef.click();\n    },\n\n    // 选择完图片后要读取该文件，然后转化格式\n    async onFileChange(e) {\n      // console.log(1)\n      // 获取文件信息\n      const files = e.target.files; // console.log(files)\n      // 没获取到\n\n      if (files[0].length === 0) {\n        this.avatar = '';\n      } else {// const fr = new FileReader()\n        // fr.readAsDataURL(files[0])\n        // fr.onload = e => {\n        // 在展示区展示\n        // this.avatar = e.target.result\n        // console.log(123)\n      }\n\n      this.avatar = URL.createObjectURL(files[0]);\n      console.log(this.avatar);\n      const form = new FormData();\n      form.append('image', files[0]);\n      await updateAvatarAPI(form); // console.log(res)\n\n      this.$message.success('保存成功'); // 更新个人信息\n\n      this.$store.dispatch('initUserInfo'); // console.log(this.ruleForm)\n    },\n\n    // 更新后台头像信息\n    async uploadFnImg() {// const { data: res } = await updateAvatarAPI(this.avatar)\n      // this.$message.success(res.message)\n      // 更新个人信息\n      // this.$store.dispatch('initUserInfo')\n      // this.$message.error(res.message)\n    },\n\n    // 点击保存用户基本信息\n    saveUserInfo() {\n      this.$refs.ruleForm.validate(async valid => {\n        if (valid) {\n          console.log(this.ruleForm); // 发出请求，送出表单内容\n\n          console.log(JSON.stringify(this.ruleForm));\n          await updateAvatarAPI(JSON.stringify(this.ruleForm)); // console.log(res)\n          // 更新个人信息\n\n          this.$store.dispatch('initUserInfo');\n          this.$message.success('个人信息已更新');\n        } else {\n          console.log(2);\n        }\n      });\n    }\n\n  },\n\n  // created(){\n  // 进来时获取用户信息\n  // }\n  async mounted() {\n    console.log(this.ruleForm);\n  }\n\n};","map":{"version":3,"mappings":"AAyCA;AACA,kC,CACA;;AACA;EACAA,eADA;EAEAC,YACA;EADA,CAFA;;EAKAC;IACA;MACA;MACAC,UAFA;MAGA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAC,oCAZA;MAaAC;QACAC,WACA;UAAAC;UAAAC;UAAAC;QAAA,CADA,CAEA;QAFA,CADA;QAKAC;UAAAH;UAAAC;UAAAC;QAAA,EACA;QADA,CALA;QAQAE,WACA;UAAAJ;UAAAC;UAAAC;UAAAG;QAAA,CADA,CAEA;QAFA,CARA;QAYAC,eACA;UAAAN;UAAAC;UAAAC;QAAA,CADA,CAEA;QAFA,CAZA;QAgBAK,UACA;UAAAP;UAAAC;UAAAC;QAAA,CADA,CAEA;QAFA,CAhBA;QAoBAM,OACA;UAAAR;UAAAC;UAAAC;QAAA,CADA,CAEA;QAFA;MApBA;IAbA;EAuCA,CA7CA;;EA8CAO;IACA;IACAC;MACA;MACA;IACA,CALA;;IAMA;IACA;MACA;MACA;MACA,6BAHA,CAIA;MACA;;MACA;QACA;MACA,CAFA,MAEA,CACA;QACA;QACA;QACA;QACA;QACA;MACA;;MACA;MACAC;MACA;MACAC;MACA,4BApBA,CAqBA;;MACA,8BAtBA,CAuBA;;MACA,qCAxBA,CAyBA;IACA,CAjCA;;IAkCA;IACA,qBACA;MAEA;MACA;MACA;MAEA;IACA,CA3CA;;IA6CA;IACAC;MACA;QACA;UACAF,2BADA,CAEA;;UACAA;UACA,qDAJA,CAKA;UACA;;UACA;UACA;QACA,CATA,MASA;UAAAA;QAAA;MACA,CAXA;IAYA;;EA3DA,CA9CA;;EA4GA;EACA;EACA;EAEA;IACAA;EACA;;AAlHA","names":["name","computed","data","avatar","ruleForm","rules","nickname","required","message","trigger","sex","birthday","type","introduction","contact","area","methods","chooseImg","console","form","saveUserInfo"],"sourceRoot":"src/views/routes","sources":["my-user.vue"],"sourcesContent":["<template>\r\n  <div class=\"my-user\">\r\n    <!-- 头像编辑功能 -->\r\n      <div class=\"photo-config\">\r\n        <img src=\"../../assets/images/用户头像.png\" alt=\"\" v-if=\"!avatar\" class=\"the_img\">\r\n        <img :src=\"avatar\" alt=\"\" v-else class=\"the_img\">\r\n        <!--  -->\r\n\r\n        <input type=\"file\" style=\"display:none\" ref=\"iptRef\" @change=\"onFileChange\" accept=\"image/*\">\r\n        <div class=\"avatar_btn\" @click=\"chooseImg\">\r\n            <img src=\"../../assets/images/编辑图标.png\" alt=\"\" >\r\n            <span>编辑头像</span>\r\n        </div>\r\n        <!-- 保存到后台头像信息 -->\r\n        <!-- <div class=\"avatar_btn\"  @click=\"uploadFnImg\">\r\n            <img src=\"../../assets/images/编辑图标.png\" alt=\"\" >\r\n            <span>保存头像</span>\r\n        </div> -->\r\n\r\n      </div>\r\n      <!-- 基本信息编辑功能 -->\r\n      <div class=\"info-config\">\r\n          <!-- 标题 -->\r\n          <div class=\"info-config-title\"><span>基本信息</span></div>\r\n          <!-- 表单 -->\r\n          <div class=\"info-config-edit\">\r\n              <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"100px\" class=\"demo-ruleForm\">\r\n                  <el-form-item  prop=\"nickname\" label=\"姓名：\" ><el-input v-model=\"ruleForm.nickname\" :placeholder=\"nickname\" @change=\"console.log(ruleForm.nickname,$store.state.userInfo)\"></el-input></el-form-item>\r\n                  <!-- <el-form-item  prop=\"sex\" label=\"性别：\"><el-radio v-model=\"ruleForm.sex\" label=\"男\" >男</el-radio><el-radio v-model=\"ruleForm.sex\" label=\"女\">女</el-radio></el-form-item> -->\r\n                  <!-- <el-form-item  prop=\"birthday\"  label=\"出生日期：\"><el-date-picker type=\"date\" :placeholder=\"birthday\" v-model=\"ruleForm.birthday\" style=\"width: 100%;\"  value-format=\"yyyy-MM-dd\"></el-date-picker></el-form-item> -->\r\n                  <el-form-item  prop=\"introduction\" label=\"简介：\"><el-input v-model=\"ruleForm.introduction\" :placeholder=\"introduction\"></el-input></el-form-item>\r\n                  <!-- <el-form-item  prop=\"contact\" label=\"联系方式：\"><el-input v-model=\"ruleForm.contact\" :placeholder=\"contact\"></el-input></el-form-item> -->\r\n                  <!-- <el-form-item  prop=\"area\"  label=\"地区：\"><el-input v-model=\"ruleForm.area\" :placeholder=\"area\"></el-input></el-form-item> -->\r\n                  <el-form-item><el-button type=\"primary\" @click=\"saveUserInfo\">保存</el-button></el-form-item>\r\n              </el-form>\r\n          </div>\r\n      </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { updateAvatarAPI } from '@/api'\r\nimport { mapGetters } from 'vuex'\r\n// import { onMounted } from 'vue'\r\nexport default {\r\n  name: 'my-user',\r\n  computed: {\r\n    ...mapGetters(['nickname', 'image', 'introduction', 'area', 'contact', 'sex', 'birthday'])\r\n  },\r\n  data () {\r\n    return {\r\n      // 保存照片的链接--base64字符串\r\n      avatar: '',\r\n      // 表单数据部分,目前无用\r\n      // ruleForm: {\r\n      //   nickname: '',\r\n      //   sex: '',\r\n      //   birthday: '',\r\n      //   introduction: '',\r\n      //   contact: '',\r\n      //   area: ''\r\n      // },\r\n      ruleForm: this.$store.state.userInfo,\r\n      rules: {\r\n        nickname: [\r\n          { required: true, message: '姓名', trigger: 'blur' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ],\r\n        sex: [{ required: true, message: '性别', trigger: 'blur' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ],\r\n        birthday: [\r\n          { required: true, message: '生日', trigger: 'blur', type: 'string' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ],\r\n        introduction: [\r\n          { required: true, message: '简介', trigger: 'blur' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ],\r\n        contact: [\r\n          { required: true, message: '联系方式', trigger: 'blur' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ],\r\n        area: [\r\n          { required: true, message: '地区', trigger: 'blur' }\r\n          // { min: 3, max: 5, message: '长度在 3 到 5 个字符', trigger: 'blur' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // 点击选择头像\r\n    chooseImg () {\r\n      // 模拟点击事件\r\n      this.$refs.iptRef.click()\r\n    },\r\n    // 选择完图片后要读取该文件，然后转化格式\r\n    async onFileChange (e) {\r\n      // console.log(1)\r\n      // 获取文件信息\r\n      const files = e.target.files\r\n      // console.log(files)\r\n      // 没获取到\r\n      if (files[0].length === 0) {\r\n        this.avatar = ''\r\n      } else {\r\n        // const fr = new FileReader()\r\n        // fr.readAsDataURL(files[0])\r\n        // fr.onload = e => {\r\n        // 在展示区展示\r\n        // this.avatar = e.target.result\r\n        // console.log(123)\r\n      }\r\n      this.avatar = URL.createObjectURL(files[0])\r\n      console.log(this.avatar)\r\n      const form = new FormData()\r\n      form.append('image', files[0])\r\n      await updateAvatarAPI(form)\r\n      // console.log(res)\r\n      this.$message.success('保存成功')\r\n      // 更新个人信息\r\n      this.$store.dispatch('initUserInfo')\r\n      // console.log(this.ruleForm)\r\n    },\r\n    // 更新后台头像信息\r\n    async uploadFnImg () {\r\n      // const { data: res } = await updateAvatarAPI(this.avatar)\r\n\r\n      // this.$message.success(res.message)\r\n      // 更新个人信息\r\n      // this.$store.dispatch('initUserInfo')\r\n\r\n      // this.$message.error(res.message)\r\n    },\r\n\r\n    // 点击保存用户基本信息\r\n    saveUserInfo () {\r\n      this.$refs.ruleForm.validate(async valid => {\r\n        if (valid) {\r\n          console.log(this.ruleForm)\r\n          // 发出请求，送出表单内容\r\n          console.log(JSON.stringify(this.ruleForm))\r\n          await updateAvatarAPI(JSON.stringify(this.ruleForm))\r\n          // console.log(res)\r\n          // 更新个人信息\r\n          this.$store.dispatch('initUserInfo')\r\n          this.$message.success('个人信息已更新')\r\n        } else { console.log(2) }\r\n      })\r\n    }\r\n  },\r\n\r\n  // created(){\r\n  // 进来时获取用户信息\r\n  // }\r\n\r\n  async mounted () {\r\n    console.log(this.ruleForm)\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.my-user{\r\n  width: 90%;\r\n  height: 95%;\r\n  background-color: rgb(255, 255, 255);\r\n  border-radius: 1rem;\r\n  //水平垂直\r\n  margin: 0 auto;\r\n  //头像设置\r\n  .photo-config{\r\n    padding-top: 5%;\r\n    height: 15%;\r\n    padding-left: 12rem;\r\n    >*{\r\n      display: inline-block;\r\n    }\r\n    .the_img{\r\n      border: 1px solid black;\r\n      width: 88px;\r\n      height: 89px;\r\n    }\r\n    .avatar_btn{\r\n      border: 1px solid black;\r\n      margin-left: 3rem;\r\n      img{\r\n      width: 15px;\r\n      height: 15px;\r\n      }\r\n    }\r\n    .avatar_btn:hover{\r\n      cursor: pointer;\r\n    }\r\n  }\r\n  .info-config{\r\n    margin-left: 10%;\r\n    margin-top: 7%;\r\n    height: 73%;\r\n    .info-config-title{\r\n      border-left: 8px rgb(1, 142, 237) solid;\r\n      span{\r\n        margin-left: 13px;\r\n      }\r\n    }\r\n    .info-config-edit{\r\n      margin-top: 57px;\r\n      .demo-ruleForm{\r\n        display: flex;\r\n        flex-direction: row;\r\n        flex-wrap: wrap;\r\n      }\r\n    }\r\n  }\r\n}\r\n.el-input{\r\n  // height: 200px;\r\n}\r\n.el-input__inner{\r\n\r\n  // height: 40% ;\r\n}\r\n.el-form-item{\r\n  width: 40%;\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}