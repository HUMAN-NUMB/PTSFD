{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: 'my-heart',\n\n  data() {\n    return {\n      isLeft: true,\n\n      /**\r\n       * websocket部分\r\n       */\n      // textarea框的信息\n      textWillSend: '',\n      path: 'ws://127.0.0.1:8001/ws/chat',\n      socket: '',\n      favicon: '',\n      message: '12345',\n      msgdata: [],\n      input: '',\n      // 获得的资源\n      // getSource: [\n      //   { img: require('@/assets/images/头像1.jpg'), info: '听说有人想不开' },\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\n      //   { img: require('@/assets/images/头像1.jpg'), info: '听说有人想不开' },\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' }\n      // ],\n      getIcons: [{\n        img_url: require('@/assets/images/视频图标(心灵树洞).png')\n      }, {\n        img_url: require('@/assets/images/图片图标.png')\n      }, {\n        img_url: require('@/assets/images/链接图标.png')\n      }, {\n        img_url: require('@/assets/images/位置图标.png')\n      }, {\n        img_url: require('@/assets/images/设置图标.png')\n      }]\n    };\n  },\n\n  mounted() {\n    this.favicon = this.$store.state.userInfo.image; // window.btoa(\n    // 初始化\n\n    this.init();\n  },\n\n  // 关闭websocket（切记）\n  destroyed() {\n    // 销毁监听\n    this.socket.onclose = this.close;\n    console.log('已销毁');\n  },\n\n  methods: {\n    // 初始化websocket\n    init: function () {\n      if (typeof WebSocket === 'undefined') {\n        alert('您的浏览器不支持socket');\n      } else {\n        // 实例化socket\n        this.socket = new WebSocket(this.path); // 监听socket连接\n\n        this.socket.onopen = this.open; // 监听socket错误信息\n\n        this.socket.onerror = this.error; // 监听socket消息\n\n        this.socket.onmessage = this.getMessage;\n      }\n    },\n    // 开启时的函数\n    open: function () {\n      console.log('socket连接成功');\n    },\n    // 出错时的函数\n    error: function () {\n      console.log('连接错误');\n    },\n    // 获取消息的函数\n    getMessage: function (msg) {\n      const data = JSON.parse(msg.data);\n      if (data.favicon === this.favicon) this.isLeft = false; // data.favicon = window.atob(msg.data.favicon)\n\n      this.msgdata.push(data);\n      console.log(data);\n    },\n    // 发送消息的函数\n    send: function () {\n      this.socket.send(JSON.stringify({\n        favicon: this.favicon,\n        message: this.textWillSend\n      }));\n    },\n    // 关闭时的函数\n    close: function () {\n      console.log('socket已经关闭');\n    },\n\n    // 点击发送，发送信息\n    sendToWs() {\n      this.send(); // 发送完清空textarea\n\n      this.textWillSend = '';\n    }\n\n  }\n};","map":{"version":3,"mappings":";AAsBA;EACAA,gBADA;;EAEAC;IACA;MACAC,YADA;;MAEA;AACA;AACA;MACA;MACAC,gBANA;MAOAC,mCAPA;MAQAC,UARA;MASAC,WATA;MAUAC,gBAVA;MAWAC,WAXA;MAaAC,SAbA;MAcA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MAEA;MACA;MAEA;MACAC,WACA;QAAAC;MAAA,CADA,EAEA;QAAAA;MAAA,CAFA,EAGA;QAAAA;MAAA,CAHA,EAIA;QAAAA;MAAA,CAJA,EAKA;QAAAA;MAAA,CALA;IA7BA;EAsCA,CAzCA;;EA0CAC;IACA,gDADA,CACA;IACA;;IACA;EACA,CA9CA;;EA+CA;EACAC;IACA;IACA;IACAC;EACA,CApDA;;EAqDAC;IACA;IACAC;MACA;QACAC;MACA,CAFA,MAEA;QACA;QACA,uCAFA,CAGA;;QACA,+BAJA,CAKA;;QACA,iCANA,CAOA;;QACA;MACA;IACA,CAfA;IAgBA;IACAC;MACAJ;IACA,CAnBA;IAoBA;IACAK;MACAL;IACA,CAvBA;IAwBA;IACAM;MACA;MACA,uDAFA,CAGA;;MACA;MAEAN;IACA,CAhCA;IAiCA;IACAO;MACA,iBACAC,eACA;QACAhB,qBADA;QAEAC;MAFA,CADA,CADA;IAQA,CA3CA;IA4CA;IACAgB;MACAT;IACA,CA/CA;;IAgDA;IACAU;MACA,YADA,CAEA;;MACA;IACA;;EArDA;AArDA","names":["name","data","isLeft","textWillSend","path","socket","favicon","message","msgdata","input","getIcons","img_url","mounted","destroyed","console","methods","init","alert","open","error","getMessage","send","JSON","close","sendToWs"],"sourceRoot":"src/views/routes","sources":["my-heart.vue"],"sourcesContent":["\r\n<template>\r\n  <div class=\"my-heart\">\r\n      <div class=\"commentArea\" >\r\n\r\n        <div  class=\"eachBox\" v-for=\"(item,index) in msgdata\" :key=\"index\">\r\n          <div :style=\"{'background-image':'url('+item.favicon+')'}\" v-if=\"item.favicon == favicon\"></div>\r\n          <div ><span>{{item.message}}</span></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"sendArea\">\r\n          <div class=\"icons\" v-for=\"(item,index) in getIcons\" :key=\"index\" :style=\"{'background-image':'url('+item.img_url+')'}\"></div>\r\n          <div class=\"input\">\r\n              <textarea name=\"\" id=\"\" cols=\"30\" rows=\"10\" v-model=\"textWillSend\"></textarea>\r\n              <div class=\"input_btn\" @click=\"sendToWs\"><span>发送</span></div>\r\n          </div>\r\n      </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  name: 'my-heart',\r\n  data () {\r\n    return {\r\n      isLeft: true,\r\n      /**\r\n       * websocket部分\r\n       */\r\n      // textarea框的信息\r\n      textWillSend: '',\r\n      path: 'ws://127.0.0.1:8001/ws/chat',\r\n      socket: '',\r\n      favicon: '',\r\n      message: '12345',\r\n      msgdata: [],\r\n\r\n      input: '',\r\n      // 获得的资源\r\n      // getSource: [\r\n      //   { img: require('@/assets/images/头像1.jpg'), info: '听说有人想不开' },\r\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\r\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\r\n      //   { img: require('@/assets/images/头像1.jpg'), info: '听说有人想不开' },\r\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\r\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\r\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\r\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' },\r\n\r\n      //   { img: require('@/assets/images/头像2.jpg'), info: '差不多得了' },\r\n      //   { img: require('@/assets/images/头像3.jpg'), info: '我前天刚刚跳来着，可惜没挂' }\r\n\r\n      // ],\r\n      getIcons: [\r\n        { img_url: require('@/assets/images/视频图标(心灵树洞).png') },\r\n        { img_url: require('@/assets/images/图片图标.png') },\r\n        { img_url: require('@/assets/images/链接图标.png') },\r\n        { img_url: require('@/assets/images/位置图标.png') },\r\n        { img_url: require('@/assets/images/设置图标.png') }\r\n      ]\r\n\r\n    }\r\n  },\r\n  mounted () {\r\n    this.favicon = this.$store.state.userInfo.image// window.btoa(\r\n    // 初始化\r\n    this.init()\r\n  },\r\n  // 关闭websocket（切记）\r\n  destroyed () {\r\n    // 销毁监听\r\n    this.socket.onclose = this.close\r\n    console.log('已销毁')\r\n  },\r\n  methods: {\r\n    // 初始化websocket\r\n    init: function () {\r\n      if (typeof (WebSocket) === 'undefined') {\r\n        alert('您的浏览器不支持socket')\r\n      } else {\r\n        // 实例化socket\r\n        this.socket = new WebSocket(this.path)\r\n        // 监听socket连接\r\n        this.socket.onopen = this.open\r\n        // 监听socket错误信息\r\n        this.socket.onerror = this.error\r\n        // 监听socket消息\r\n        this.socket.onmessage = this.getMessage\r\n      }\r\n    },\r\n    // 开启时的函数\r\n    open: function () {\r\n      console.log('socket连接成功')\r\n    },\r\n    // 出错时的函数\r\n    error: function () {\r\n      console.log('连接错误')\r\n    },\r\n    // 获取消息的函数\r\n    getMessage: function (msg) {\r\n      const data = JSON.parse(msg.data)\r\n      if (data.favicon === this.favicon) this.isLeft = false\r\n      // data.favicon = window.atob(msg.data.favicon)\r\n      this.msgdata.push(data)\r\n\r\n      console.log(data)\r\n    },\r\n    // 发送消息的函数\r\n    send: function () {\r\n      this.socket.send(\r\n        JSON.stringify(\r\n          {\r\n            favicon: this.favicon,\r\n            message: this.textWillSend\r\n          }\r\n        )\r\n      )\r\n    },\r\n    // 关闭时的函数\r\n    close: function () {\r\n      console.log('socket已经关闭')\r\n    },\r\n    // 点击发送，发送信息\r\n    sendToWs () {\r\n      this.send()\r\n      // 发送完清空textarea\r\n      this.textWillSend = ''\r\n    }\r\n  }\r\n\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.my-heart{\r\n    width: 90%;\r\n    height: 95%;\r\n    background-color: rgb(255, 255, 255);\r\n    border-radius: 1rem;\r\n    //水平垂直\r\n    margin: 0 auto;\r\n        max-height: 95%;\r\n    .commentArea{\r\n        margin: 0 auto;\r\n        width: 95%;\r\n        height: 70%;\r\n        // background-color: red;\r\n        overflow: auto;\r\n        max-height: 70%;\r\n        // display: flex;\r\n        .eachBox{\r\n          width: 100%;\r\n          height: 70px;\r\n          margin-top: 10px;\r\n            // flex: 1;\r\n  // flex-shrink: 0;\r\n  // height: 0;\r\n  // width: 100%;\r\n  // display: flex;\r\n          // background-color: rgb(235, 235, 235);\r\n          display: flex;\r\n          align-items: center;\r\n          div:first-child{\r\n            // display: inline-block;\r\n            width: 50px;\r\n            height: 50px;\r\n            background-size: 100% 100%;\r\n            border-radius: 25px;\r\n          }\r\n          div:last-child{\r\n            // display: inline-block;\r\n            // width: 50p;\r\n            display: flex;\r\n            align-items: center;\r\n            height: 34px;\r\n            background-color: rgb(98, 178, 231);\r\n            position: relative;\r\n            top: 6px;\r\n            left: 21px;\r\n            border-radius: 5px;\r\n            span{\r\n              color: rgb(236, 254, 234);\r\n              padding: 0 24px;\r\n            }\r\n          }\r\n        }\r\n        .eachBox2{\r\n          align-items: center;\r\n          div:last-child{\r\n            top: 6px;\r\n            right: 21px;\r\n          }\r\n        }\r\n    }\r\n    .sendArea{\r\n        border-top: 1px solid rgb(167, 167, 167);\r\n        margin: 0 auto;\r\n        width: 95%;\r\n        height: 30%;\r\n        background-color: white;\r\n\r\n        .icons{\r\n          width: 26px;\r\n          height: 26px;\r\n          // background-color: red;\r\n          background-size: 100% 100%;\r\n          display: inline-block;\r\n          margin-right: 3%;\r\n          margin-top: 1%;\r\n        }\r\n        .input{\r\n          height: 74%;\r\n          width: 100%;\r\n          position: relative;\r\n          >textarea{\r\n            height: 49%;\r\n            width: 99%;\r\n            border: none;\r\n            outline:none;\r\n            color: rgb(135, 135, 135);\r\n            font-size: 20px;\r\n          }\r\n          // >textarea:focus-visible{\r\n          //   outline-offset: none !important;;\r\n          // }\r\n          .input_btn{\r\n            width: 9%;\r\n            height: 30%;\r\n            background-color: #60afea;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            border-radius: 14px;\r\n            position: absolute;\r\n            bottom: 1px;\r\n            right: 3%;\r\n            >span{\r\n              color: white;\r\n              font-size: 19px;\r\n            }\r\n          }\r\n          .input_btn:hover{\r\n            cursor: pointer;\r\n          }\r\n        }\r\n    }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}